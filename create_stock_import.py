import json
import random
import requests

# 定義するデータを一箇所で管理
config = {
    "store_codes": ["961", "942", "935", "934", "874", "814", "811", "803", "801", "781", "775", "702", "697", "694", "689", "671", "663", "662", "649", "644", "637", "628", "625", "623", "612", "606", "547", "532", "482", "465", "441", "421", "389", "384", "373", "304", "274", "206", "200", "185", "182", "175", "173", "172", "168", "154", "145", "112", "109", "105"],
    "jans": ["4987035673514", "4987035646617", "4987035617310", "4987035573814", "4987035092216", "49811353", "4980765000643", "49755251", "4973480346844", "4971980789260", "4971650205571", "4962840968383", "4962840968369", "4955129025167", "4955129020100", "4953103254350", "4946842520244", "4946842501908", "49433050", "49433043", "49431902", "4936790540715", "4930391140763", "4909411085650", "4909411084950", "4909411084875", "4909411084790", "4905846118666", "4904670497688", "4904670496216", "4904230073574", "4904230073550", "4904230073536", "4904230073512", "4904230073475", "4904230073420", "4904230073192", "4903333253920", "4903333133062", "4903032243406", "4903032242409", "4903015500151", "4903015500144", "4903015500137", "4903015500120", "4903015500113", "4902888724558", "4902888711114", "4902888232374", "4902888116322", "4902888116209", "4902777140070", "4902777139746", "4902777132129", "4902124023063", "4902102155090", "4902102155076", "4902102155014", "4902102154390", "4902102148597", "4902102146982", "4902102141215", "4902102139311", "4902102130240", "4902102084178", "4902102072618", "4902102069359", "4902039496013", "4901880211165", "4901880211141", "4901880211134", "4901880211127", "4901880211042", "4901880210854", "4901880210564", "4901880210557", "4901870647233", "4901870647219", "4901870647196", "4901777415690", "4901777415362", "4901777415218", "4901777415195", "4901777413603", "4901777413566", "4901777413450", "4901777413290", "4901777412361", "4901777412347", "4901777411999", "4901777411975", "4901777411470", "4901777411227", "4901777411081", "4901777410909", "4901777410756", "4901777409828", "4901777409804", "4901777409781", "4901777409767", "4901777366411", "4901777077416", "4901777018686", "4901411133225", "4901411133195", "4901411133171", "4901411133164", "4901411133157", "4901411133133", "4901411131856", "4901411131832", "4901411131795", "4901411131757", "4901411131733", "4901411131696", "4901411131634", "4901411131597", "4901411131573", "4901411130675", "4901411130651", "4901411130293", "4901411130279", "4901411130231", "4901411130194", "4901411122137", "4901411122090", "4901411121536", "4901411121499", "4901411121475", "4901411121451", "4901360355006", "4901360352173", "4901360352166", "4901360352142", "4901330578923", "4901330578916", "4901330578909", "4901330575786", "4901313207734", "4901085161982", "4901035120014", "4901004061812", "4901004061690", "4901004061683", "4901004061652", "4901004061638", "4901004061607", "4901004061331", "4901004061324", "4901004061300", "4901004061294", "4901004061270", "4901004061256", "4901004057693", "4901004057686", "4897036690017", "4589850826214", "4582228244375", "4580287293174", "4560292290016", "4560173192002", "4514603449914", "4514603263213", "2841003193980", "2147345347532", "1124211242444"],
    "request_count": 100,
    "staff_code": "1111",
}

# ランダムに入荷リクエストを生成する関数
def generate_random_arrival_request():
    store_code = random.choice(config["store_codes"])
    items = []

    # ランダムに商品を生成（重複しないように）
    num_items = random.randint(5, 20)  # 1〜5個の商品のリスト
    selected_jans = random.sample(config["jans"], min(num_items, len(config["jans"])))

    for jan in selected_jans:
        additional_stock = random.randint(1, 20)  # 1〜10の範囲で追加在庫数を設定
        items.append({
            "jan": jan,
            "additional_stock": additional_stock
        })
    
    # リクエストの構造体を生成
    arrival_request = {
        "store_code": store_code,
        "staff_code": config["staff_code"],
        "items": items
    }
    
    return arrival_request

# 成功件数と失敗件数の初期化
success_count = 0
failure_count = 0

# リクエストを生成し、送信を繰り返す
for _ in range(config["request_count"]):  # 指定した回数リクエストを送信
    request_data = generate_random_arrival_request()
    request_json = json.dumps(request_data, ensure_ascii=False)

    try:
        response = requests.post('http://nest-store.f5.si:8500/api/stocks/receive/', data=request_json, headers={'Content-Type': 'application/json'})
        
        # ステータスコードをチェック
        if response.status_code == 200:  # 成功した場合
            success_count += 1
        else:  # それ以外は失敗
            failure_count += 1
            print(f"エラー: ステータスコード {response.status_code}, レスポンス内容: {response.text}")  # エラー内容を表示
    except Exception as e:
        failure_count += 1  # エラーが発生した場合も失敗としてカウント
        print(f"エラーが発生しました: {e}")  # エラーメッセージを表示

# 最後に成功件数と失敗件数を表示
print(f"成功件数: {success_count}")
print(f"失敗件数: {failure_count}")